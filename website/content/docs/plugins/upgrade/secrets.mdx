---
layout: docs
page_title: Upgrade secret engine plugins
description: >-
    Upgrade secret engine plugins running in Vault.
---

# Upgrade secret engine plugins

TBD

## Before you start

- **TBD**
- **TBD**

## Step 1: TBD

The process is nearly identical for auth and secret plugins. If you are upgrading
an auth plugin, just replace all usages of `secrets` or `secret` with `auth`.

1. [Register][plugin_registration] the first version of your plugin to the catalog.
   Skip this step if your initial plugin is built-in or already registered.

    ```shell-session
    $ vault plugin register \
        -sha256=<SHA256 Hex value of the plugin binary> \
        secret \
        my-secret-plugin
    Success! Registered plugin: my-secret-plugin
    ```

1. [Mount][plugin_management] the plugin. Skip this step if your initial plugin
   is already mounted.

    ```shell-session
    $ vault secrets enable my-secret-plugin
    Success! Enabled the my-secret-plugin secrets engine at: my-secret-plugin/
    ```

1. Register a second version of your plugin. You **must** use the same plugin
   type and name (the last two arguments) as the plugin being upgraded. This is
   true regardless of whether the plugin being upgraded is built-in or external.

    ```shell-session
    $ vault plugin register \
        -sha256=<SHA256 Hex value of the plugin binary> \
        -command=my-secret-plugin-1.0.1 \
        -version=v1.0.1 \
        secret \
        my-secret-plugin
    Success! Registered plugin: my-secret-plugin
    ```

1. Set the new version as the cluster's pinned version.

   ```shell-session
   $ vault write sys/plugins/pins/secret/my-secret-plugin version=v1.0.1
   ```

1. Trigger a global [plugin reload](/vault/docs/commands/plugin/reload) to
   reload all instances of the plugin.

    ```shell-session
    $ vault plugin reload -type=secret -plugin=my-secret-plugin -scope=global
    Success! Reloading plugin: my-secret-plugin, reload_id: 98b1e875-4217-745d-07f2-93d14219fb3c
    ```

1. **Optional:** Check the "Running Version" field to verify the new version is
    running:

    ```shell-session
    $ vault secrets list -detailed
    ```

Until the reload step, the mount will still run the first version of `my-secret-plugin`. When
the reload is triggered, Vault will kill `my-secret-plugin`â€™s process and start the
new plugin process for `my-secret-plugin` version 1.0.1.



[plugin_registration]: /vault/docs/plugins/plugin-architecture#plugin-registration
[plugin_management]: /vault/docs/plugins/plugin-management#enabling-disabling-external-plugins
