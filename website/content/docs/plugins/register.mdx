---
layout: docs
page_title: Enable external plugins
description: >-
  Register and enable an external plugin with Vault
---

# Register and enable external plugins

An external plugin is any plugin External plugins are implemented separately
from Vault's built-in plugins. These plugins can be either authentication or
secrets engines.

## Before you start 

- **You must had admin permissions for Vault**. Specifically, you must be able
  to run `plugin register` and the appropriate `enable` command.
- **You must have `plugin_directory` configured for your Vault instance**.
- **You must have the plugin binary saved to the location set in `plugin_directory`**.
- **You must know the SHA hash of your plugin binary**. 
- **You must have `api_addr` set in your Vault configuration file. The plugin
  registration process uses [`api_addr`](/vault/docs/configuration#api_addr)
  to establish communication with the Vault server during mount time. If the
  storage backend has HA enabled and supports automatic host address detection,
  Vault tries to determine the appropriate URL automatically, but we recommend
  setting the parameter explicitly to avoid complications.

## Step 1: Update the plugin catalog

You must register your external plugin with the Vault catalog before enabling
it. Registering plugins ensures the plugin invoked by Vault is authentic and
maintains integrity.

<Tabs>

<Tab heading="CLI" group="cli">

Use [`vault plugin register`](/vault/docs/commands/plugin/register) to add your
plugin to the catalog:

```shell-session
$ vault plugin register \
    <plugin_type>       \
    <plugin_name>       \
    -command <command_to_run_plugin_binary>
    -sha256 <sha256_value_of_plugin_binary>
```

For example, to register a secrets plugin called `passthrough`:

<CodeBlockConfig hideClipboard="true">

```shell-session
$ vault plugin register \
    -command runplugin
    -sha256 7f83b1657ff1fc53b92dc18148a1d65dfc2d4b1fa3d677284addd200126d9069
    secret              \
    my-custom-plugin    \

Success! Registered plugin: my-custom-plugin
```

</CodeBlockConfig>

</Tab>

<Tab heading="API" group="API">

Write the command and SHA256 value of your plugin binary to a JSON file and use
the [RegisterPlugin](/vault/api-docs/system/plugins-catalog#register-plugin)
endpoint to add your plugin to the catalog:

```shell-session
$ curl                                      \
  --request POST                            \
  --header "X-Vault-Token: ${VAULT_TOKEN}"  \
  --data @data.json                         \
  ${VAULT_ADDR}/v1/sys/plugins/catalog/<plugin_type>/<plugin_name>
```

For example, to register a secrets plugin called `my-custom-plugin` that
executes with the command `runplugin`:

<CodeBlockConfig hideClipboard="true">

```json
{
  "command": "runplugin"
  "sha256": "7f83b1657ff1fc53b92dc18148a1d65dfc2d4b1fa3d677284addd200126d9069"
}
```

</CodeBlockConfig>

<CodeBlockConfig hideClipboard="true">

```shell-session
$ curl                                        \
    --request POST                            \
    --header "X-Vault-Token: ${VAULT_TOKEN}"  \
    --data @data.json                         \
  ${VAULT_ADDR}/v1/sys/plugins/catalog/secret/my-custom-plugin | jq

{
  "request_id": "0c872d86-0def-4261-34d9-b796039ec02f",
  "lease_id": "",
  "renewable": false,
  "lease_duration": 0,
  "data": {
    "created_time": "2024-11-15T02:41:02.556301319Z",
    "custom_metadata": null,
    "deletion_time": "",
    "destroyed": false,
    "version": 5
  },
  "wrap_info": null,
  "warnings": null,
  "auth": null,
  "mount_type": "kv"
}
```

</CodeBlockConfig>


<CodeBlockConfig hideClipboard="true">

```shell-session
$ vault plugin register \
    secret              \
    my-custom-plugin    \
    -sha256=7f83b1657ff1fc53b92dc18148a1d65dfc2d4b1fa3d677284addd200126d9069

Success! Registered plugin: my-custom-plugin
```

</CodeBlockConfig>

</Tab>

</Tabs>

## Step 2: Enable the plugin

You can mount registered plugins using the registered plugin name:

```shell-session
$ vault secrets enable -path=my-secrets passthrough-plugin
Success! Enabled the passthrough-plugin secrets engine at: my-secrets/
```
Use the appropriate enable command to mount the registered plugin.

<Tabs>

<Tab heading="Authentication">

<Tabs>

<Tab heading="CLI" group="cli">

Use [`vault auth enable`](/vault/docs/commands/auth/enable) to mount your
authentication plugin:

```shell-session
$ vault auth enable     \
    <plugin_name>       \
    -path <mount_path>  \
    -namespace <target_namespace>
```

For example, to register an authentication plugin called `my-custom-plugin`:

<CodeBlockConfig hideClipboard="true">

```shell-session
$ vault auth enable    \
    my-custom-plugin   \
    -path custom-auth  \
    -namespace <target_namespace>

Success! Enabled the my-custom-plugin auth method at: custom-auth/
```

</CodeBlockConfig>

</Tab>

<Tab heading="API" group="api">

Auth API code

</Tab>

</Tabs>

</Tab>


<Tab heading="Secret">

<Tabs>

<Tab heading="CLI" group="cli">

Use [`vault secrets enable`](/vault/docs/commands/secrets/enable) to mount your
authentication plugin:

```shell-session
$ vault secrets enable  \
    <plugin_name>       \
    -path <mount_path>  \
    -namespace <target_namespace>
```

For example, to register a secrets plugin called `my-custom-plugin`:

<CodeBlockConfig hideClipboard="true">

```shell-session
$ vault secrets enable    \
    my-custom-plugin      \
    -path custom-secrets  \
    -namespace <target_namespace>

Success! Enabled the my-custom-plugin secrets engine at: custom-secrets/
```

</CodeBlockConfig>

</Tab>

<Tab heading="API" group="api">

Secrets API code

</Tab>

</Tabs>

</Tab>


<Tab heading="Database">

TBD

</Tab>

</Tabs>

## Step 3: Verify 

Listing secrets engines will display secrets engines that are mounted as
plugins:

```shell-session
$ vault secrets list
Path         Type       Accessor            Plugin              Default TTL  Max TTL  Force No Cache  Replication Behavior  Description
my-secrets/  plugin     plugin_deb84140     passthrough-plugin  system       system   false           replicated
```

Disabling an external plugins is identical to disabling a built-in plugin:

```shell-session
$ vault secrets disable my-secrets
```

## Plugin environment variables

An advantage for external plugins over builtin plugins is they can specify
additional environment variables because they are run in their own process.

-> Vault 1.16.0 changed the precedence given to plugin-specific environment
variables so they take priority over Vault's environment. See full details in
the [upgrade notes](/vault/docs/upgrading/upgrade-to-1.16.x).

Use the `-env` flag once per environment variable that a plugin should be
started with:

```shell-session
$ vault plugin register -sha256=<SHA256 Hex value of the plugin binary> \
    -env REGION=eu \
    -env TOKEN_FILE=/var/run/token \
    secret \                  # type
    passthrough-plugin

Success! Registered plugin: passthrough-plugin
```

### Plugin-specific HTTP proxy settings

Many tools and libraries automatically consume `HTTP_PROXY`, `HTTPS_PROXY`, and
`NO_PROXY` environment variables to configure HTTP proxy settings, including the
Go standard library's default HTTP client. You can use these environment
variables to configure different network proxies for different plugins:

-> You must be using an external plugin to take advantage of custom environment
variables. If you are using a builtin plugin, you can still download and register
an external version of it in order to use this workflow. Check the
[releases](https://releases.hashicorp.com/) page for the latest prebuilt plugin
binaries.

```shell-session
$ vault plugin register -sha256=<SHA256 Hex value of the plugin binary> \
    -env HTTP_PROXY=eu.example.com \
    auth \
    jwt-eu

Success! Registered plugin: jwt-eu

$ vault plugin register -sha256=<SHA256 Hex value of the plugin binary> \
    -env HTTP_PROXY=us.example.com \
    auth \
    jwt-us

Success! Registered plugin: jwt-us
```

You can then enable each plugin on its own path, and configure clients that
should be associated with one or the other appropriately:

```shell-session
$ vault auth enable jwt-eu
Success! Enabled the jwt-eu auth method at: auth/jwt-eu/

$ vault auth enable jwt-us
Success! Enabled the jwt-us auth method at: auth/jwt-us/
```
